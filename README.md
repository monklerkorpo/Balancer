# –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —Ä–∞–∑–æ–≥—Ä–µ–≤–∞
üîπ–û–ø–∏—à–∏—Ç–µ —Å–∞–º—É—é –∏–Ω—Ç–µ—Ä–µ—Å–Ω—É—é –∑–∞–¥–∞—á—É –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏, –∫–æ—Ç–æ—Ä—É—é –≤–∞–º –ø—Ä–∏—Ö–æ–¥–∏–ª–æ—Å—å —Ä–µ—à–∞—Ç—å?
-–†–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–ª API –¥–ª—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∫–Ω–∏–≥ –Ω–∞ Go, –≥–¥–µ –≥–ª–∞–≤–Ω–æ–π –∑–∞–¥–∞—á–µ–π –±—ã–ª–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Å PostgreSQL ‚Äî –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–¥–µ–ª–∞–ª –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏ –∞–≤—Ç–æ—Ä–æ–≤ –∏ –∫–Ω–∏–≥, –Ω–æ –∏–∑-–∑–∞ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–ª –¥–∞–Ω–Ω—ã–µ, –¥–æ–±–∞–≤–∏–≤ –∏–º—è –∞–≤—Ç–æ—Ä–∞ –ø—Ä—è–º–æ –≤ —Ç–∞–±–ª–∏—Ü—É –∫–Ω–∏–≥. –î–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ PostgreSQL –∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ Redis. –°—Ç–æ–ª–∫–Ω—É–ª—Å—è —Å –ø—Ä–æ–±–ª–µ–º–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ –∫–Ω–∏–≥, –∫–æ—Ç–æ—Ä—É—é —Ä–µ—à–∏–ª —Å –ø–æ–º–æ—â—å—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏ –º—å—é—Ç–µ–∫—Å–æ–≤. –í –ø—Ä–æ—Ü–µ—Å—Å–µ –Ω–∞—É—á–∏–ª—Å—è –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ EXPLAIN –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã. –≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –¥–∞–ª –º–Ω–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ, –∫–æ–≥–¥–∞ –º–æ–∂–Ω–æ –∂–µ—Ä—Ç–≤–æ–≤–∞—Ç—å –∏–¥–µ–∞–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –ë–î —Ä–∞–¥–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

üîπ–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–≤–æ–µ–º —Å–∞–º–æ–º –±–æ–ª—å—à–æ–º —Ñ–∞–∫–∞–ø–µ?
-–ù–∞ —Ö–∞–∫–∞—Ç–æ–Ω–µ –¥–µ–ª–∞–ª —á–∞—Ç –Ω–∞ WebSockets (Go + gorilla/websocket), –Ω–æ –∑–∞–±—ã–ª –∑–∞–∫—Ä—ã–≤–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –ß–µ—Ä–µ–∑ —á–∞—Å —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–µ—Ä —Å—ä–µ–ª –≤—Å—é –ø–∞–º—è—Ç—å –∏ —É–ø–∞–ª ‚Äî –æ–∫–∞–∑–∞–ª–æ—Å—å, –≥–æ—Ä—É—Ç–∏–Ω—ã –≤–∏—Å–µ–ª–∏ –≤ —Ñ–æ–Ω–µ –∏ –∫–æ–ø–∏–ª–∏ –¥–∞–Ω–Ω—ã–µ. –ü—Ä–∏—à–ª–æ—Å—å —Å—Ä–æ—á–Ω–æ —á–∏–Ω–∏—Ç—å –Ω–∞ –∂–∏–≤–æ–º –ø—Ä–æ–µ–∫—Ç–µ –ø–µ—Ä–µ–¥ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–µ–π –∂—é—Ä–∏.

üîπ–ß—Ç–æ –≤—ã –ø—Ä–µ–¥–ø—Ä–∏–Ω—è–ª–∏ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã?
-–î–æ–±–∞–≤–∏–ª defer conn.Close() –∏ —Ç–∞–π–º–∞—É—Ç—ã —á–µ—Ä–µ–∑ context.WithTimeout, –ø–ª—é—Å –Ω–∞—Å—Ç—Ä–æ–∏–ª –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —É—Ç–µ—á–µ–∫ —á–µ—Ä–µ–∑ pprof. –¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ä–µ–ª–∏–∑–æ–º –∑–∞–ø—É—Å–∫–∞—é –ø—Ä–æ–≤–µ—Ä–∫—É: go func() { for { log.Println("Num goroutines:", runtime.NumGoroutine()); time.Sleep(5 * time.Second) } }(). –≠—Ç–æ—Ç –æ–ø—ã—Ç –Ω–∞—É—á–∏–ª –º–µ–Ω—è –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–µ–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ä–µ—Å—É—Ä—Å–∞–º–∏ –≤ Go.

–ö–∞–∫–æ–≤—ã –≤–∞—à–∏ –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç —É—á–∞—Å—Ç–∏—è –≤ –±—É—Ç–∫–µ–º–ø–µ?
-–•–æ—á—É –≥–ª—É–±–∂–µ —Ä–∞–∑–æ–±—Ä–∞—Ç—å –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–µ–º—ã Go: –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ (pprof, trace), –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç–∏ (worker pools, graceful shutdown) –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é SQL-–∑–∞–ø—Ä–æ—Å–æ–≤. –û—Å–æ–±–µ–Ω–Ω–æ —Ü–µ–Ω–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–¥ —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏ –≤ –∫–æ–º–∞–Ω–¥–µ –∏ –ø–æ–ª—É—á–∞—Ç—å —Ñ–∏–¥–±–µ–∫ –æ—Ç –æ–ø—ã—Ç–Ω—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤. –ì–æ—Ç–æ–≤ –∞–∫—Ç–∏–≤–Ω–æ —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –∏ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∑–Ω–∞–Ω–∏—è –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ!

# ‚öñÔ∏è Load Balancer with Rate Limiting (Go)

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç HTTP-–ø—Ä–æ–∫—Å–∏ —Å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º —Å–∫–æ—Ä–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ (rate limiting), health check'–∞–º–∏, –∞ —Ç–∞–∫–∂–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —É–ø—Ä–∞–≤–ª—è—Ç—å –ª–∏–º–∏—Ç–∞–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ REST API. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ‚Äî **–≥–µ–∫—Å–∞–≥–æ–Ω–∞–ª—å–Ω–∞—è**, –º–æ–¥—É–ª—å–Ω–∞—è –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è.

##  –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **Round-Robin, least connections, random –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞** –º–µ–∂–¥—É backend-—Å–µ—Ä–≤–µ—Ä–∞–º–∏
- ‚úÖ **Token Bucket Rate Limiter** (–≥–ª–æ–±–∞–ª—å–Ω—ã–π –∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π per-client)
- ‚úÖ **Health Check backend-–æ–≤** (–∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∏–∑ –ø—É–ª–∞ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏)
- ‚úÖ **CRUD API** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ (`/clients`)
- ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Gorilla Mux**
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** —á–µ—Ä–µ–∑ `zap`
- ‚úÖ **–ú–æ–∫-—Å–µ—Ä–≤–µ—Ä—ã** –¥–ª—è —Ç–µ—Å—Ç–æ–≤ backend-—Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ **–ë–¥**  Sqlite

##  –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ cmd/                # –ì–ª–∞–≤–Ω—ã–π –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ api/            # HTTP-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏ —Ä–æ—É—Ç–∏–Ω–≥
‚îÇ   ‚îú‚îÄ‚îÄ app/            # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —Å–µ—Ä–≤–µ—Ä–∞.
‚îÇ   ‚îú‚îÄ‚îÄ server/         # –û—Å–Ω–æ–≤–Ω–æ–π HTTP-—Å–µ—Ä–≤–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∏–π –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã.
‚îÇ   ‚îú‚îÄ‚îÄ balancer/       # Strategy, Backend, Health Check
‚îÇ   ‚îú‚îÄ‚îÄ proxy/          # –ü—Ä–æ–∫—Å–∏ –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ ratelimiter/    # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Token Bucket Rate Limiter
‚îÇ   ‚îî‚îÄ‚îÄ storage/        # Sqlite —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è ClientRepository
‚îú‚îÄ‚îÄ test/               # –ú–æ–∫–æ–≤—ã–µ backend-—Å–µ—Ä–≤–µ—Ä—ã // # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ configs/            # YAML –∫–æ–Ω—Ñ–∏–≥–∏
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ docker-compose.yml
‚îî‚îÄ‚îÄ README.md           # –í—ã –∑–¥–µ—Å—å!
```
##  –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è 
```
port: 8080
backends:
  - "http://backend1:9001"  
  - "http://backend2:9002"
rate_limit:
  capacity: 100
  refill_rate: 10
databasePath: "clients.db"
strategy: round_robin  # –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ least_connections , round_robin, random, –ø–æ—Ç–æ–º—É —á—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å —Ñ–∞–±—Ä–∏–∫–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π.
```
##  –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —á–µ—Ä–µ–∑ Docker

```bash
docker-compose up --build
```

–ü–æ—Ä—Ç—ã:

- `:8080` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π Load Balancer
- `:9001`, `:9002` ‚Äî –º–æ–∫-—Å–µ—Ä–≤–µ—Ä–∞

##  HTTP API

###  `POST /clients`

–°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞:

```json
{
  "client_id": "user123",
  "capacity": 10,
  "rate_per_sec": 5
}
```

- `201 Created` ‚Äî –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏
- `409 Conflict` ‚Äî –∫–ª–∏–µ–Ω—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

###  `GET /clients`

–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤.

###  `GET /clients/{id}`

–ü–æ–ª—É—á–∏—Ç—å –ª–∏–º–∏—Ç –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ ID.

###  `PUT /clients/{id}`

–û–±–Ω–æ–≤–∏—Ç—å –ª–∏–º–∏—Ç –∫–ª–∏–µ–Ω—Ç–∞.

```json
{
  "client_id": "user123",
  "capacity": 15,
  "rate_per_sec": 10
}
```

- `400 Bad Request` ‚Äî ID –≤ URL –∏ –≤ —Ç–µ–ª–µ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç
- `404 Not Found` ‚Äî –∫–ª–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω

###  `DELETE /clients/{id}`

–£–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞.

- `200 OK` ‚Äî –∫–ª–∏–µ–Ω—Ç —É–¥–∞–ª—ë–Ω
- `404 Not Found` ‚Äî –∫–ª–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω

##  Rate Limiting
–†–µ–∞–ª–∏–∑–∞—Ü–∏—è Rate Limiting

üîπ–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ Token Bucket –∞–ª–≥–æ—Ä–∏—Ç–º–∞:
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π "–≤–µ–¥—Ä–æ" —Ç–æ–∫–µ–Ω–æ–≤
–ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å —Ä–∞—Å—Ö–æ–¥—É–µ—Ç –æ–¥–∏–Ω —Ç–æ–∫–µ–Ω
–ê–≤—Ç–æ–ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã (time.Ticker)

üîπ–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤:
–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É X-API-Key
–ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ - –ø–æ X-Real-IP/X-Forwarded-For
–í –∫—Ä–∞–π–Ω–µ–º —Å–ª—É—á–∞–µ - –ø–æ RemoteAddr
–ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞:
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å 429 (Too Many Requests)
–î–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–≥–æ–ª–æ–≤–æ–∫ Retry-After —Å –≤—Ä–µ–º–µ–Ω–µ–º –æ–∂–∏–¥–∞–Ω–∏—è

üîπ–ì–∏–±–∫–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–∫:
–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã –∑–∞–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ SetClientLimit(clientID, ClientLimit{...})
–í–æ–∑–º–æ–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞–º–∏ (–ë–î, Redis) –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∞–≤–∏–ª




### üîπ –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):

- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç—Å—è –≤ `ratelimiter.RateLimiter`
- –í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã –ø–æ–¥–ø–∞–¥–∞—é—Ç –ø–æ–¥ —ç—Ç–æ—Ç –ª–∏–º–∏—Ç, –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π

### üîπ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç:

- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ API `/clients`
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–µ–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ

##  Health Checks

- –ù–µ–∑–¥–æ—Ä–æ–≤—ã–µ —Å–µ—Ä–≤–µ—Ä–∞ –∏—Å–∫–ª—é—á–∞—é—Ç—Å—è –∏–∑ –ø—É–ª–∞

##  –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

## Benchmark

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –±–µ–Ω—á–º–∞—Ä–∫–∏ –¥–ª—è Rate Limiter –∑–∞–ø—É—Å–∫–∞–ª–∏—Å—å —Å —Ñ–ª–∞–≥–∞–º–∏ `-race` –∏ `-benchmem`, —á—Ç–æ–±—ã –æ—Ü–µ–Ω–∏—Ç—å –∫–∞–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —Ç–∞–∫ –∏ –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞:

```bash
go test -bench=. -tags=integration -benchmem -race ./test/integration/ratelimiter
```

–ü–æ–∫—Ä—ã–≤–∞–µ—Ç:

- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ IP  
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ API –∫–ª—é—á—É  
- –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞  


##  –ú–æ–∫-—Å–µ—Ä–≤–µ—Ä—ã

–î–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ backend'–æ–≤:

- `test/mock/server1` ‚Äî –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Å `Hello from mock server 1`
- `test/mock/server2` ‚Äî –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –Ω–æ —Å `mock server 2`



## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç CRUD –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö (–ø–æ–¥—Ä–æ–±–Ω—ã–π)
```
go test -v -count=1 ./test/integration/api
```

##  –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ Postman –∏–ª–∏ curl

```bash
curl -X POST http://localhost:8080/clients \
  -H "Content-Type: application/json" \
  -d '{"client_id": "user1", "capacity": 10, "rate_per_sec": 5}'
```
## –ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ratelimiter –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —é–∑–µ—Ä–∞
``` 
curl -X POST http://localhost:8080/clients      -H "Content-Type: application/json"      -d '{"client_id":"user4","capacity":4,"rate_per_sec":10}'
{"client_id":"user4","capacity":4,"rate_per_sec":10}
for i in {1..10}; do   curl -i http://localhost:8080/     -H "X-Client-ID: user4"; done

```
## –ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (ab -n 1000 -c 100 -H "X-Real-IP: 1.1.1.1" http://localhost:8080/) –ø—Ä–∏ –æ–±—â–µ–º rate_limit:  capacity: 100 refill_rate: 10
```
Concurrency Level:      100
Time taken for tests:   0.400 seconds
Complete requests:      1000
Failed requests:        900
   (Connect: 0, Receive: 0, Length: 900, Exceptions: 0)
Non-2xx responses:      900
Total transferred:      165400 bytes
HTML transferred:       43000 bytes
Requests per second:    2501.81 [#/sec] (mean)
Time per request:       39.971 [ms] (mean)
Time per request:       0.400 [ms] (mean, across all concurrent requests)
Transfer rate:          404.10 [Kbytes/sec] received
```

## –¢–∞–∫ –∂–µ –µ—Å—Ç—å unit-—Ç–µ—Å—Ç—ã –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞ 
```
go test -v ./internal/balancer/...
```


##  –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- Go 1.21+
- Gorilla Mux
- Uber Zap (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
- Docker / Docker Compose
- Sqlite

# balancer
